<style type="text/css">
    #drawsocket {
        top: 0px;
    }

    .quintetnet_div {
      width: 160px;
      top: 0px;
    }

    .quintetnet_div video {
        width: 160px;
        height: 120px;
        background-color: black;
    }

</style>

<div class="quintetnet_div">
    <button id="startbutton">start stream</button> 
    <video id="quintetnet-local" autoplay playsinline muted></video>
    <video id="quintetnet-1" autoplay playsinline muted></video>
    <video id="quintetnet-2" autoplay playsinline muted></video>
    <video id="quintetnet-3" autoplay playsinline muted></video>
    <video id="quintetnet-4" autoplay playsinline muted></video>
    <video id="quintetnet-5" autoplay playsinline muted></video>
</div>

<script>
    const url_args = new URLSearchParams(window.location.search);
    console.log(`hello user ${url_args.get('id')}`);


    async function streamHandler(stream, kind, id) {
        console.log('----> received stream ');

        return 1; // return 1 to disable default action

        const tag = kind + '-' + id;

        let el = $('#' + tag);

        if (!el) {
            el = document.createElement(kind);
            el.setAttribute('playsinline', '');
            el.setAttribute('autoplay', '');
            //el.setAttribute('muted', '');
            //el.setAttribute('controls', true);

            el.id = tag;

            el.srcObject = stream;

            $(`#videos`).appendChild(el);

            await el.play()
                .catch((error) => {
                    console.error('elememt failed to play:', error, el);
                    el.setAttribute('controls', '');
                });

        }

    }

    drawsocket.on_newPeerStream = async (stream, kind, id) => {
        streamHandler(stream, kind, id);
        return 1;
    }

    drawsocket.on_newLocalStream = async (stream) => {
        let localvid = document.getElementById("quintetnet-local");
        localvid.srcObject = stream;

        return 1;
    }


    function init() {

        let ui_div = document.getElementById('default_ui');
        let localUI_div = document.getElementById('local_ui');

        ui_div.parentElement.removeChild(ui_div);
        localUI_div.parentElement.removeChild(localUI_div);
        

        let startbutton = document.getElementById('startbutton');
        startbutton.addEventListener("click", drawsocket.startStream );

        console.log( drawsocket.getMediaStreams() );
/*

        const streams = drawsocket.getMediaStreams();
        const videoIds = Object.keys(streams.video);
        if (videoIds.length > 0) {
            const firstStream = streams.video[videoIds[0]];
            streamHandler(firstStream.stream, 'video', videoIds[0]);
        }
*/

    }



    init();


</script>